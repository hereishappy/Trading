<!DOCTYPE html><html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Attendance Summary — START SHIFT</title>
  <meta name="description" content="Search your name and auto-download your attendance summary as a JPEG." />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
  <style>
    :root{
      --bg:#0f172a;          /* slate-900 */
      --card:#0b1226;        /* deep slate */
      --muted:#94a3b8;       /* slate-400 */
      --text:#e2e8f0;        /* slate-200 */
      --brand:#22c55e;       /* green-500 */
      --brand-600:#16a34a;   /* green-600 */
      --danger:#ef4444;      /* red-500 */
      --accent:#38bdf8;      /* sky-400 */
      --border: #1f2937;     /* gray-800 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 80% -10%, #0b1226 10%, #0f172a 60%, #0a0f1f 100%);
      color:var(--text);
    }
    .container{max-width:900px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;justify-content:space-between;margin:8px 0 24px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,var(--brand),var(--accent));display:grid;place-items:center;color:#001b0b;font-weight:800}
    .title{font-size:clamp(18px,3vw,24px);font-weight:700;letter-spacing:0.3px}
    .subtitle{font-size:14px;color:var(--muted)}.search-card{background:rgba(255,255,255,0.02);border:1px solid var(--border);border-radius:20px;padding:18px;backdrop-filter: blur(6px);box-shadow:0 10px 30px rgba(0,0,0,.35)}
.row{display:flex;gap:10px;flex-wrap:wrap}
.field{flex:1 1 260px;display:flex;align-items:center;gap:10px;background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:14px;padding:12px 14px}
.field input{width:100%;background:transparent;border:none;outline:none;color:var(--text);font-size:16px}
.btn{appearance:none;border:none;border-radius:14px;padding:12px 18px;font-weight:700;letter-spacing:.2px;cursor:pointer;transition:.2s background,.2s transform;display:inline-flex;align-items:center;gap:10px}
.btn-primary{background:linear-gradient(135deg,var(--brand),var(--brand-600));color:#04130b}
.btn-primary:hover{transform:translateY(-1px)}
.btn-secondary{background:#111827;color:var(--text);border:1px solid var(--border)}

.hint{margin-top:10px;color:var(--muted);font-size:13px}

/* Report card (what gets converted to JPEG) */
.report-wrap{margin-top:28px}
.report{display:none; background:linear-gradient(180deg,#0e152b, #0c1330 60%, #0b1226); border:1px solid var(--border);border-radius:24px;padding:24px;position:relative;overflow:hidden;box-shadow:0 16px 40px rgba(0,0,0,.45)}
.r-head{display:flex;align-items:center;justify-content:space-between;border-bottom:1px dashed #1f2b46;padding-bottom:14px;margin-bottom:18px}
.r-brand{display:flex;align-items:center;gap:12px}
.r-logo{width:52px;height:52px;border-radius:16px;background:linear-gradient(135deg,var(--brand),var(--accent));display:grid;place-items:center;color:#001b0b;font-weight:900;font-size:18px}
.badge{font-size:12px;color:#0c1a12;background:linear-gradient(135deg,var(--brand),var(--brand-600));padding:6px 10px;border-radius:999px;font-weight:800;letter-spacing:.3px}

.grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:14px}
.stat{background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:18px;padding:14px}
.stat .label{font-size:12px;color:var(--muted);letter-spacing:.3px}
.stat .value{font-size:26px;font-weight:800;margin-top:6px}

.table{width:100%;border-collapse:collapse;margin-top:12px}
.table th,.table td{border-bottom:1px dashed #1e2744;padding:10px 8px;text-align:left;font-size:14px}
.table th{color:var(--muted);font-weight:600}

.watermark{position:absolute;right:-40px;bottom:-40px;width:220px;height:220px;border-radius:50%;background:radial-gradient(circle at 30% 30%, rgba(56,189,248,.25), transparent 60%), radial-gradient(circle at 70% 70%, rgba(34,197,94,.25), transparent 60%)}

.toast{display:none;position:fixed;right:16px;bottom:16px;background:#111827;color:var(--text);border:1px solid var(--border);border-radius:14px;padding:12px 14px;box-shadow:0 8px 24px rgba(0,0,0,.4)}
.err{color:var(--danger)}

@media (max-width:680px){
  .grid{grid-template-columns:1fr}
  .r-head{align-items:flex-start;gap:10px}
}

  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">SC</div>
        <div>
          <div class="title">Start Shift — Attendance Portal</div>
          <div class="subtitle">Search your name • Get a pro report (JPEG)</div>
        </div>
      </div>
      <button class="btn btn-secondary" id="btnDownloadLast" title="Download last report again" style="display:none">Download Again</button>
    </header><section class="search-card">
  <div class="row">
    <label class="field" for="name">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M21 21l-3.5-3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/></svg>
      <input id="name" placeholder="Type your name (e.g., AMAN KUMAR)" autocomplete="name" />
    </label>
    <button class="btn btn-primary" id="btnSearch">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Get My Report
    </button>
  </div>
  <div class="hint">Admin note: set <code>CSV_URL</code> to your Google Sheet’s published CSV or a raw CSV in this repo. If fetching fails, the built‑in sample below is used so the app still works.</div>
  <div class="hint">Expected headers: <strong>Date</strong>, <strong>Supervisor</strong>, <strong>EMP NAME</strong>, <strong>Shift Hours</strong>, <strong>OT HOURS</strong>.</div>
</section>

<div class="report-wrap">
  <div id="report" class="report" role="region" aria-live="polite" aria-label="Attendance summary report">
    <div class="watermark" aria-hidden="true"></div>
    <div class="r-head">
      <div class="r-brand">
        <div class="r-logo">SC</div>
        <div>
          <div class="title" id="rTitle">Attendance Summary</div>
          <div class="subtitle" id="rSub">Start Shift • —</div>
        </div>
      </div>
      <span class="badge" id="rBadge">AUG 2025</span>
    </div>
    <div class="grid">
      <div class="stat"><div class="label">Employee</div><div class="value" id="rName">—</div></div>
      <div class="stat"><div class="label">Days Present</div><div class="value" id="rDays">0</div></div>
      <div class="stat"><div class="label">Overtime Hours</div><div class="value" id="rOT">0</div></div>
    </div>
    <table class="table" id="rTable" aria-label="Attendance entries">
      <thead><tr><th>Date</th><th>Supervisor</th><th>Shift Hours</th><th>OT Hours</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

  </div>  <div class="toast" id="toast">Report downloaded</div>  <script>
    // ======= CONFIG =======
    // 1) If using Google Sheets, publish the sheet (File → Share → Publish to web → Link → Sheet: START SHIFT → CSV)
    //    Then paste the export URL below. It should look like:
    //    https://docs.google.com/spreadsheets/d/<SHEET_ID>/export?format=csv&gid=<GID>
    // 2) Or, commit a CSV file to your GitHub repo (e.g., data/start_shift.csv) and put the raw URL here.
    const CSV_URL = ""; // <- set this. If left empty or fails, SAMPLE_CSV is used.

    // Built-in sample fallback (from your message)
    const SAMPLE_CSV = `Date,Supervisor,EMP NAME,Shift Hours,OT HOURS\n`
      + `1 August 2025,MAHENDRA KUMAR,AMAN KUMAR,8,4\n`
      + `1 August 2025,MAHENDRA KUMAR,ATUL MAHADEO,8,4\n`
      + `1 August 2025,MAHENDRA KUMAR,CHANDAN KUMAR,8,4\n`
      + `1 August 2025,HARKIRAT SINGH,DAULAT YADAV,8,\n`
      + `1 August 2025,MAHENDRA KUMAR,DEEPAK DAS,8,4\n`
      + `1 August 2025,MAHENDRA KUMAR,DEEPAK KUMAR,8,4\n`
      + `1 August 2025,PINTU SAH,FOOL SINGH,8,\n`
      + `1 August 2025,HARKIRAT SINGH,HARKIRAT,8,\n`
      + `1 August 2025,HARKIRAT SINGH,KIRAN PASWAN,8,\n`
      + `1 August 2025,MAHENDRA KUMAR,MAHENDRA KUMAR,8,4\n`
      + `1 August 2025,HARKIRAT SINGH,MINTU,8,\n`
      + `1 August 2025,HARKIRAT SINGH,MITLESH KUMAR,8,\n`
      + `1 August 2025,PINTU SAH,NANDAN KUMAR,8,\n`
      + `1 August 2025,HARKIRAT SINGH,NARESH KUMAR,8,`;

    // ======= UTILITIES =======
    const qs = (s, el=document) => el.querySelector(s);
    const qsa = (s, el=document) => Array.from(el.querySelectorAll(s));
    const toNum = (v) => {
      if (v === null || v === undefined) return 0;
      if (typeof v === 'number') return v;
      const s = String(v).trim();
      if (!s) return 0;
      const n = Number(s.replace(/[^0-9.\-]/g, ''));
      return isFinite(n) ? n : 0;
    };
    const fmt = new Intl.NumberFormat(undefined, { maximumFractionDigits: 2 });

    function detectDelimiter(line){
      // Support commas or tabs automatically
      const commas = (line.match(/,/g) || []).length;
      const tabs = (line.match(/\t/g) || []).length;
      return tabs > commas ? '\t' : ',';
    }

    function parseCSV(text){
      // Lightweight parser for simple CSV/TSV (no quoted commas inside fields in this dataset)
      const firstLine = text.split(/\r?\n/)[0] || '';
      const delim = detectDelimiter(firstLine);
      const lines = text.split(/\r?\n/).filter(Boolean);
      const headers = lines.shift().split(delim).map(h=>h.trim());
      return lines.map(line => {
        const parts = line.split(delim).map(p=>p.trim());
        const obj = {};
        headers.forEach((h,i)=> obj[h] = parts[i] ?? '');
        return obj;
      });
    }

    async function loadData(){
      if (!CSV_URL){
        return parseCSV(SAMPLE_CSV);
      }
      try{
        const res = await fetch(CSV_URL, { cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const text = await res.text();
        return parseCSV(text);
      }catch(err){
        console.warn('Failed to fetch CSV_URL, using SAMPLE_CSV. Reason:', err);
        return parseCSV(SAMPLE_CSV);
      }
    }

    function normalizeName(s){
      return (s||'').toString().trim().replace(/\s+/g,' ').toUpperCase();
    }

    function computeSummary(rows){
      const dates = new Set();
      let ot = 0, shift = 0;
      rows.forEach(r=>{
        const sh = toNum(r['Shift Hours']);
        const oh = toNum(r['OT HOURS']);
        if (sh > 0) dates.add((r['Date']||'').trim());
        shift += sh;
        ot += oh;
      });
      return { daysPresent: dates.size, totalOT: ot, totalShift: shift };
    }

    function renderReport({empName, rows}){
      const report = qs('#report');
      const tbody = qs('#rTable tbody');
      tbody.innerHTML = '';

      // Limit to latest 12 rows for the table (still shows totals above)
      const limited = rows.slice(0, 12);
      limited.forEach(r=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r['Date']||''}</td><td>${r['Supervisor']||''}</td><td>${r['Shift Hours']||''}</td><td>${r['OT HOURS']||''}</td>`;
        tbody.appendChild(tr);
      });

      const { daysPresent, totalOT, totalShift } = computeSummary(rows);
      qs('#rName').textContent = empName;
      qs('#rDays').textContent = fmt.format(daysPresent);
      qs('#rOT').textContent = fmt.format(totalOT);

      // Subhead and badge (month-year if detectable)
      const dates = rows.map(r => (r['Date']||'').trim()).filter(Boolean);
      const monthBadge = (()=>{
        if (!dates.length) return '';
        // Try to extract month name + year from first row
        const m = dates[0].match(/([A-Za-z]+)\s+(\d{4})/);
        return m ? (m[1].slice(0,3).toUpperCase() + ' ' + m[2]) : '';
      })();
      qs('#rBadge').textContent = monthBadge || 'SUMMARY';
      qs('#rSub').textContent = `Start Shift • ${rows.length} entries • Shift Hours: ${fmt.format(totalShift)}`;

      report.style.display = 'block';
    }

    async function generateAndDownload(empQuery){
      const data = await loadData();
      const target = normalizeName(empQuery);
      if (!target){
        showToast('Please enter a name.');
        return;
      }
      // Filter rows for the employee
      const rows = data.filter(r => normalizeName(r['EMP NAME']) === target);
      if (!rows.length){
        showToast('No records found for "' + empQuery + '"', true);
        qs('#report').style.display = 'none';
        return;
      }
      renderReport({ empName: empQuery.trim(), rows });
      await downloadReportJPEG();
      qs('#btnDownloadLast').style.display = 'inline-flex';
    }

    async function downloadReportJPEG(){
      const node = qs('#report');
      // Give fonts/layout a frame to settle
      await new Promise(r => setTimeout(r, 60));
      const canvas = await html2canvas(node, { scale: 2, backgroundColor: null, useCORS: true });
      const dataURL = canvas.toDataURL('image/jpeg', 0.95);
      const nameText = normalizeName(qs('#rName').textContent).replace(/[^A-Z0-9]+/g,'_');
      const a = document.createElement('a');
      const now = new Date();
      const y = now.getFullYear();
      const m = String(now.getMonth()+1).padStart(2,'0');
      const d = String(now.getDate()).padStart(2,'0');
      a.href = dataURL;
      a.download = `${nameText || 'ATTENDANCE'}_${y}${m}${d}.jpg`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      showToast('Report downloaded');
    }

    function showToast(msg, error=false){
      const t = qs('#toast');
      t.textContent = msg;
      t.style.borderColor = error ? 'var(--danger)' : 'var(--border)';
      t.style.display = 'block';
      clearTimeout(showToast._timer);
      showToast._timer = setTimeout(()=>{ t.style.display = 'none'; }, 3000);
    }

    // ======= EVENTS =======
    qs('#btnSearch').addEventListener('click', () => {
      const name = qs('#name').value;
      generateAndDownload(name);
    });
    qs('#name').addEventListener('keydown', (e)=>{
      if (e.key === 'Enter') qs('#btnSearch').click();
    });
    qs('#btnDownloadLast').addEventListener('click', downloadReportJPEG);

    // Optional: prefill for demo
    // qs('#name').value = 'AMAN KUMAR';
  </script></body>
</html>
